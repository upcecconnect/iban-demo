import{$ as I,d as _,r as A,o as g,c as p,a as i,e as x,t as m,F as h,f as S,g as K}from"./index-BH32cic5.js";const V="/iban-demo/icons/tabler/star-filled.svg",H="/iban-demo/icons/tabler/star.svg",k=new Map;k.set("901",{code:"901",iconAltTextI18nKey:"bank.privat.logo.alt",iconUrl:"icons/banks/privat.svg",titleI18nKey:"bank.privat"});k.set("902",{code:"902",iconAltTextI18nKey:"bank.monobank.logo.alt",iconUrl:"icons/banks/monobank.svg",titleI18nKey:"bank.monobank"});k.set("903",{code:"903",iconAltTextI18nKey:"bank.abank.logo.alt",iconUrl:"icons/banks/abank.svg",titleI18nKey:"bank.abank"});const $=k,F=e=>Array.isArray(e)?e.every(t=>typeof t=="string"&&t.length===3):!1,d={favoriteBanksCodes:{get(){try{const e=localStorage.getItem("favorite-banks-codes");if(!e)return new Set;const t=JSON.parse(e);return F(t)?new Set(t):new Set}catch(e){return console.error("Failed to load favorite banks codes"),new Set}},set(e){try{localStorage.setItem("favorite-banks-codes",JSON.stringify(Array.from(e)))}catch(t){console.error("Failed to save favorite banks codes")}}},lastUsedBankCode:{get(){try{const e=localStorage.getItem("lastUsedBankCode");return e&&e.length===3?e:null}catch(e){return console.error("Failed to load last used bank code"),null}},set(e){try{localStorage.setItem("lastUsedBankCode",e)}catch(t){console.error("Failed to save last used bank code")}}}},U="https://ecg.test.upc.ua/payByBank",f=(e,t)=>{try{const{code:n}=e,o=$.get(n);return o?{...o,isFavorite:t.has(n)}:null}catch(n){return null}},T=async e=>I.get("".concat(U,"/api/payByBank/bankList/").concat(e)).then(({data:t})=>{if(t.invoiceId!==e)throw new Error("Invalid response");return t.banks.map(n=>f(n,d.favoriteBanksCodes.get())).filter(n=>n!==null)}).catch(()=>(console.error("Failed to fetch banks list"),[{code:"901",iconAltTextI18nKey:"bank.privat.logo.alt",iconUrl:"icons/banks/privat.svg",titleI18nKey:"bank.privat"},{code:"902",iconAltTextI18nKey:"bank.monobank.logo.alt",iconUrl:"icons/banks/monobank.svg",titleI18nKey:"bank.monobank"},{code:"903",iconAltTextI18nKey:"bank.abank.logo.alt",iconUrl:"icons/banks/abank.svg",titleI18nKey:"bank.abank"}].map(t=>f(t,d.favoriteBanksCodes.get())).filter(t=>t!==null)));var r=[];for(var b=0;b<256;++b)r.push((b+256).toString(16).slice(1));function D(e,t=0){return(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase()}var y,L=new Uint8Array(16);function N(){if(!y&&(y=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!y))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return y(L)}var E=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const C={randomUUID:E};function M(e,t,n){if(C.randomUUID&&!t&&!e)return C.randomUUID();e=e||{};var o=e.random||(e.rng||N)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,D(o)}const P=async(e,t)=>{const n=e+t,a=new TextEncoder().encode(n),u=await crypto.subtle.digest("SHA-512",a);return new Uint8Array(u)},R=(e,t)=>{const n=Uint8Array.from(atob(e),a=>a.charCodeAt(0)),o=new Uint8Array(n.length);for(let a=0;a<n.length;a++)o[a]=n[a]^t[a%t.length];return new TextDecoder().decode(o)},O=async(e,t)=>{const n=M(),{data:o}=await I.post("".concat(U,"/api/payByBank/preparePay"),{invoiceId:e,bankCode:t},{headers:{"User-Info":n}}),a=d.favoriteBanksCodes.get();a.has(t)||(a.add(t),d.favoriteBanksCodes.set(a)),d.lastUsedBankCode.set(t);const u=await P(navigator.userAgent,n);return R(o,u)},j="data:image/svg+xml,%3csvg%20width='41'%20height='20'%20viewBox='0%200%2041%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M34.1395%205.55421H40.4837V0.00806114H34.1395C31.3503%200.00806114%2028.9399%201.74123%2027.7711%204.24829C26.5699%201.67674%2024.0145%200.00806114%2021.2495%200.00806114H14.2604V0.0322446C14.2604%200.0241833%2014.2523%200.00806114%2014.2362%200.00806114H11.1245C10.0202%200.00806114%209.11729%200.975413%209.11729%202.16848V7.52922C9.11729%208.66586%208.36759%209.71383%207.31157%209.81056C6.13462%209.92342%205.14309%208.92382%205.14309%207.67432V0.0322446C5.14309%200.00806077%205.13503%200%205.11084%200H0.0322452C0.00806139%200%200%200.00806077%200%200.0322446V7.38412C0%2011.4873%202.87787%2015.0988%206.67473%2015.3406C10.8182%2015.6066%2014.2523%2012.0838%2014.2523%207.67432V5.53003V5.53809H21.3624C22.1524%205.53809%2022.9182%206.0137%2023.2084%206.79565C23.7807%208.33535%2022.7408%209.81056%2021.3785%209.81056H19.4599H16.2596C15.1552%209.81056%2014.2523%2010.7779%2014.2523%2011.971V15.3567V20H19.4599V15.3567H21.3785C24.1757%2015.3567%2026.5861%2013.6235%2027.7549%2011.1084C28.9238%2013.6235%2031.3341%2015.3567%2034.1314%2015.3567H40.4756V9.81056H34.1314C33.0351%209.81056%2032.1483%208.85127%2032.1483%207.67432C32.1564%206.5135%2033.0431%205.55421%2034.1395%205.55421Z'%20fill='%231369FF'/%3e%3c/svg%3e",J={class:"bank-list-page__header"},q=["src","alt"],G={class:"bank-list-page__main"},Z={class:"bank-list-page__ul"},z=["onClick"],Q=["src","alt"],W=["alt"],X=["alt"],ee=_({__name:"index",props:{invoiceId:{type:Number,required:!0}},emits:{loaded:()=>!0,error:()=>!0},setup(e,{emit:t}){const n=e,o=A([]),a=t;(async()=>{document.body.classList.add("mobile");const s=n.invoiceId;if(!s){a("error");return}const c=await T(s).catch(()=>null);if(!c||!c.length){console.error("No banks"),a("error");return}const l=d.lastUsedBankCode.get();if(!l){o.value=c,a("loaded");return}o.value=[...c].sort((v,B)=>v.code===l?-1:B.code===l?1:0),a("loaded")})();const u=async s=>{K.show();const c=await O(n.invoiceId,s);window.location.href=c},w=s=>"/iban-demo/".concat(s);return(s,c)=>(g(),p(h,null,[i("header",J,[i("img",{src:x(j),alt:s.$t("text.upc.logo")},null,8,q),i("h1",null,m(s.$t("select.your.bank.for.payment")),1),c[0]||(c[0]=i("div",null,null,-1))]),i("main",G,[i("ul",Z,[(g(!0),p(h,null,S(o.value,l=>(g(),p("li",{key:l.code,class:"bank-list-page__li"},[i("button",{type:"button",class:"bank-list-page__button-action",onClick:v=>u(l.code)},[i("img",{src:w(l.iconUrl),alt:s.$t(l.iconAltTextI18nKey)},null,8,Q),i("span",null,m(s.$t(l.titleI18nKey)),1),l.isFavorite?(g(),p("img",{key:0,src:V,alt:s.$t("text.icon.star.filled")},null,8,W)):(g(),p("img",{key:1,src:H,alt:s.$t("text.icon.star")},null,8,X))],8,z)]))),128))])])],64))}});export{ee as default};
