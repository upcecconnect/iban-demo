import{$ as U,d as x,r as m,o as d,c as u,a as i,e as $,t as h,b as A,F as f,f as K,g as C}from"./index-BAl1rtxF.js";import{b as H}from"./browser-CboWctPp.js";const F="/iban-demo/icons/tabler/star-filled.svg",T="/iban-demo/icons/tabler/star.svg",b=new Map;b.set("901",{code:"901",iconAltTextI18nKey:"bank.privat.logo.alt",iconUrl:"/icons/banks/privat.svg",titleI18nKey:"bank.privat"});b.set("902",{code:"902",iconAltTextI18nKey:"bank.monobank.logo.alt",iconUrl:"/icons/banks/monobank.svg",titleI18nKey:"bank.monobank"});b.set("903",{code:"903",iconAltTextI18nKey:"bank.abank.logo.alt",iconUrl:"/icons/banks/abank.svg",titleI18nKey:"bank.abank"});const L=b,D=t=>Array.isArray(t)?t.every(e=>typeof e=="string"&&e.length===3):!1,g={favoriteBanksCodes:{get(){try{const t=localStorage.getItem("favorite-banks-codes");if(!t)return new Set;const e=JSON.parse(t);return D(e)?new Set(e):new Set}catch(t){return console.error("Failed to load favorite banks codes"),new Set}},set(t){try{localStorage.setItem("favorite-banks-codes",JSON.stringify(Array.from(t)))}catch(e){console.error("Failed to save favorite banks codes")}}},lastUsedBankCode:{get(){try{const t=localStorage.getItem("lastUsedBankCode");return t&&t.length===3?t:null}catch(t){return console.error("Failed to load last used bank code"),null}},set(t){try{localStorage.setItem("lastUsedBankCode",t)}catch(e){console.error("Failed to save last used bank code")}}}},w="https://ecg.test.upc.ua",I=(t,e)=>{try{const{code:r}=t,a=L.get(r);return a?{...a,isFavorite:e.has(r)}:null}catch(r){return null}},N=async t=>U.get("".concat(w,"/api/payByBank/bankList/").concat(t)).then(({data:e})=>{if(e.invoiceId!==t)throw new Error("Invalid response");return e.banks.map(r=>I(r,g.favoriteBanksCodes.get())).filter(r=>r!==null)}).catch(()=>(console.error("Failed to fetch banks list"),[{code:"901",iconAltTextI18nKey:"bank.privat.logo.alt",iconUrl:"/icons/banks/privat.svg",titleI18nKey:"bank.privat"},{code:"902",iconAltTextI18nKey:"bank.monobank.logo.alt",iconUrl:"/icons/banks/monobank.svg",titleI18nKey:"bank.monobank"},{code:"903",iconAltTextI18nKey:"bank.abank.logo.alt",iconUrl:"/icons/banks/abank.svg",titleI18nKey:"bank.abank"}].map(e=>I(e,g.favoriteBanksCodes.get())).filter(e=>e!==null)));var n=[];for(var y=0;y<256;++y)n.push((y+256).toString(16).slice(1));function R(t,e=0){return(n[t[e+0]]+n[t[e+1]]+n[t[e+2]]+n[t[e+3]]+"-"+n[t[e+4]]+n[t[e+5]]+"-"+n[t[e+6]]+n[t[e+7]]+"-"+n[t[e+8]]+n[t[e+9]]+"-"+n[t[e+10]]+n[t[e+11]]+n[t[e+12]]+n[t[e+13]]+n[t[e+14]]+n[t[e+15]]).toLowerCase()}var k,M=new Uint8Array(16);function P(){if(!k&&(k=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!k))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return k(M)}var E=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const _={randomUUID:E};function O(t,e,r){if(_.randomUUID&&!e&&!t)return _.randomUUID();t=t||{};var a=t.random||(t.rng||P)();return a[6]=a[6]&15|64,a[8]=a[8]&63|128,R(a)}const j=async(t,e)=>{const r=O(),{data:a}=await U.post("".concat(w,"/api/payByBank/preparePay"),{invoiceId:t,bankCode:e},{headers:{"User-Info":r}}),c=g.favoriteBanksCodes.get();return c.has(e)||(c.add(e),g.favoriteBanksCodes.set(c)),g.lastUsedBankCode.set(e),a},q="data:image/svg+xml,%3csvg%20width='41'%20height='20'%20viewBox='0%200%2041%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M34.1395%205.55421H40.4837V0.00806114H34.1395C31.3503%200.00806114%2028.9399%201.74123%2027.7711%204.24829C26.5699%201.67674%2024.0145%200.00806114%2021.2495%200.00806114H14.2604V0.0322446C14.2604%200.0241833%2014.2523%200.00806114%2014.2362%200.00806114H11.1245C10.0202%200.00806114%209.11729%200.975413%209.11729%202.16848V7.52922C9.11729%208.66586%208.36759%209.71383%207.31157%209.81056C6.13462%209.92342%205.14309%208.92382%205.14309%207.67432V0.0322446C5.14309%200.00806077%205.13503%200%205.11084%200H0.0322452C0.00806139%200%200%200.00806077%200%200.0322446V7.38412C0%2011.4873%202.87787%2015.0988%206.67473%2015.3406C10.8182%2015.6066%2014.2523%2012.0838%2014.2523%207.67432V5.53003V5.53809H21.3624C22.1524%205.53809%2022.9182%206.0137%2023.2084%206.79565C23.7807%208.33535%2022.7408%209.81056%2021.3785%209.81056H19.4599H16.2596C15.1552%209.81056%2014.2523%2010.7779%2014.2523%2011.971V15.3567V20H19.4599V15.3567H21.3785C24.1757%2015.3567%2026.5861%2013.6235%2027.7549%2011.1084C28.9238%2013.6235%2031.3341%2015.3567%2034.1314%2015.3567H40.4756V9.81056H34.1314C33.0351%209.81056%2032.1483%208.85127%2032.1483%207.67432C32.1564%206.5135%2033.0431%205.55421%2034.1395%205.55421Z'%20fill='%231369FF'/%3e%3c/svg%3e",J={class:"bank-list-page__header"},G=["src","alt"],Z={class:"bank-list-page__main"},z=["src"],Q={class:"bank-list-page__ul"},W=["onClick"],X=["src","alt"],Y=["alt"],tt=["alt"],at=x({__name:"index",props:{invoiceId:{type:Number,required:!0}},emits:{loaded:()=>!0,error:()=>!0},setup(t,{emit:e}){const r=t,a=m([]),c=m(null),p=e;(async()=>{document.body.classList.add("mobile");const o=r.invoiceId;if(!o){p("error");return}const l=await N(o).catch(()=>null);if(!l||!l.length){console.error("No banks"),p("error");return}const s=g.lastUsedBankCode.get();if(!s){a.value=l,p("loaded");return}a.value=[...l].sort((v,V)=>v.code===s?-1:V.code===s?1:0),p("loaded")})();const B=async o=>{alert("Navigate to app with bank code: ".concat(o)),C.show();const l=await j(r.invoiceId,o);c.value=await H.toDataURL(l,{width:300}).catch(()=>null),C.hide()},S=o=>"/iban-demo/".concat(o);return(o,l)=>(d(),u(f,null,[i("header",J,[i("img",{src:$(q),alt:o.$t("text.upc.logo")},null,8,G),i("h1",null,h(o.$t("select.your.bank.for.payment")),1),l[0]||(l[0]=i("div",null,null,-1))]),i("main",Z,[c.value?(d(),u("img",{key:0,src:c.value,alt:""},null,8,z)):A("",!0),i("ul",Q,[(d(!0),u(f,null,K(a.value,s=>(d(),u("li",{key:s.code,class:"bank-list-page__li"},[i("button",{type:"button",class:"bank-list-page__button-action",onClick:v=>B(s.code)},[i("img",{src:S(s.iconUrl),alt:o.$t(s.iconAltTextI18nKey)},null,8,X),i("span",null,h(o.$t(s.titleI18nKey)),1),s.isFavorite?(d(),u("img",{key:0,src:F,alt:o.$t("text.icon.star.filled")},null,8,Y)):(d(),u("img",{key:1,src:T,alt:o.$t("text.icon.star")},null,8,tt))],8,W)]))),128))])])],64))}});export{at as default};
