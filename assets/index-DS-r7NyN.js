import{$ as I,d as w,r as x,o as u,c as g,a as i,e as S,t as v,F as m,f as V,g as A}from"./index-CsWiEYu8.js";const K="/iban-demo/icons/tabler/star-filled.svg",$="/iban-demo/icons/tabler/star.svg",k=new Map;k.set("901",{code:"901",iconAltTextI18nKey:"bank.privat.logo.alt",iconUrl:"/icons/banks/privat.svg",titleI18nKey:"bank.privat"});k.set("902",{code:"902",iconAltTextI18nKey:"bank.monobank.logo.alt",iconUrl:"/icons/banks/monobank.svg",titleI18nKey:"bank.monobank"});k.set("903",{code:"903",iconAltTextI18nKey:"bank.abank.logo.alt",iconUrl:"/icons/banks/abank.svg",titleI18nKey:"bank.abank"});const H=k,F=t=>Array.isArray(t)?t.every(e=>typeof e=="string"&&e.length===3):!1,d={favoriteBanksCodes:{get(){try{const t=localStorage.getItem("favorite-banks-codes");if(!t)return new Set;const e=JSON.parse(t);return F(e)?new Set(e):new Set}catch(t){return console.error("Failed to load favorite banks codes"),new Set}},set(t){try{localStorage.setItem("favorite-banks-codes",JSON.stringify(Array.from(t)))}catch(e){console.error("Failed to save favorite banks codes")}}},lastUsedBankCode:{get(){try{const t=localStorage.getItem("lastUsedBankCode");return t&&t.length===3?t:null}catch(t){return console.error("Failed to load last used bank code"),null}},set(t){try{localStorage.setItem("lastUsedBankCode",t)}catch(e){console.error("Failed to save last used bank code")}}}},C="https://ecg.test.upc.ua",h=(t,e)=>{try{const{code:a}=t,o=H.get(a);return o?{...o,isFavorite:e.has(a)}:null}catch(a){return null}},T=async t=>I.get("".concat(C,"/api/payByBank/bankList/").concat(t)).then(({data:e})=>{if(e.invoiceId!==t)throw new Error("Invalid response");return e.banks.map(a=>h(a,d.favoriteBanksCodes.get())).filter(a=>a!==null)}).catch(()=>(console.error("Failed to fetch banks list"),[{code:"901",iconAltTextI18nKey:"bank.privat.logo.alt",iconUrl:"/icons/banks/privat.svg",titleI18nKey:"bank.privat"},{code:"902",iconAltTextI18nKey:"bank.monobank.logo.alt",iconUrl:"/icons/banks/monobank.svg",titleI18nKey:"bank.monobank"},{code:"903",iconAltTextI18nKey:"bank.abank.logo.alt",iconUrl:"/icons/banks/abank.svg",titleI18nKey:"bank.abank"}].map(e=>h(e,d.favoriteBanksCodes.get())).filter(e=>e!==null)));var n=[];for(var y=0;y<256;++y)n.push((y+256).toString(16).slice(1));function L(t,e=0){return(n[t[e+0]]+n[t[e+1]]+n[t[e+2]]+n[t[e+3]]+"-"+n[t[e+4]]+n[t[e+5]]+"-"+n[t[e+6]]+n[t[e+7]]+"-"+n[t[e+8]]+n[t[e+9]]+"-"+n[t[e+10]]+n[t[e+11]]+n[t[e+12]]+n[t[e+13]]+n[t[e+14]]+n[t[e+15]]).toLowerCase()}var p,D=new Uint8Array(16);function N(){if(!p&&(p=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!p))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return p(D)}var M=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const f={randomUUID:M};function P(t,e,a){if(f.randomUUID&&!e&&!t)return f.randomUUID();t=t||{};var o=t.random||(t.rng||N)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,L(o)}const R=async(t,e)=>{const a=P(),{data:o}=await I.post("".concat(C,"/api/payByBank/preparePay"),{invoiceId:t,bankCode:e},{headers:{"User-Info":a}}),c=d.favoriteBanksCodes.get();return c.has(e)||(c.add(e),d.favoriteBanksCodes.set(c)),d.lastUsedBankCode.set(e),o},E="data:image/svg+xml,%3csvg%20width='41'%20height='20'%20viewBox='0%200%2041%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M34.1395%205.55421H40.4837V0.00806114H34.1395C31.3503%200.00806114%2028.9399%201.74123%2027.7711%204.24829C26.5699%201.67674%2024.0145%200.00806114%2021.2495%200.00806114H14.2604V0.0322446C14.2604%200.0241833%2014.2523%200.00806114%2014.2362%200.00806114H11.1245C10.0202%200.00806114%209.11729%200.975413%209.11729%202.16848V7.52922C9.11729%208.66586%208.36759%209.71383%207.31157%209.81056C6.13462%209.92342%205.14309%208.92382%205.14309%207.67432V0.0322446C5.14309%200.00806077%205.13503%200%205.11084%200H0.0322452C0.00806139%200%200%200.00806077%200%200.0322446V7.38412C0%2011.4873%202.87787%2015.0988%206.67473%2015.3406C10.8182%2015.6066%2014.2523%2012.0838%2014.2523%207.67432V5.53003V5.53809H21.3624C22.1524%205.53809%2022.9182%206.0137%2023.2084%206.79565C23.7807%208.33535%2022.7408%209.81056%2021.3785%209.81056H19.4599H16.2596C15.1552%209.81056%2014.2523%2010.7779%2014.2523%2011.971V15.3567V20H19.4599V15.3567H21.3785C24.1757%2015.3567%2026.5861%2013.6235%2027.7549%2011.1084C28.9238%2013.6235%2031.3341%2015.3567%2034.1314%2015.3567H40.4756V9.81056H34.1314C33.0351%209.81056%2032.1483%208.85127%2032.1483%207.67432C32.1564%206.5135%2033.0431%205.55421%2034.1395%205.55421Z'%20fill='%231369FF'/%3e%3c/svg%3e",O={class:"bank-list-page__header"},j=["src","alt"],J={class:"bank-list-page__main"},q={class:"bank-list-page__ul"},G=["onClick"],Z=["src","alt"],z=["alt"],Q=["alt"],X=w({__name:"index",props:{invoiceId:{type:Number,required:!0}},emits:{loaded:()=>!0,error:()=>!0},setup(t,{emit:e}){const a=t,o=x([]),c=e;(async()=>{document.body.classList.add("mobile");const r=a.invoiceId;if(!r){c("error");return}const l=await T(r).catch(()=>null);if(!l||!l.length){console.error("No banks"),c("error");return}const s=d.lastUsedBankCode.get();if(!s){o.value=l,c("loaded");return}o.value=[...l].sort((b,B)=>b.code===s?-1:B.code===s?1:0),c("loaded")})();const U=async r=>{A.show();const l=await R(a.invoiceId,r);window.location.href=l},_=r=>"/iban-demo/".concat(r);return(r,l)=>(u(),g(m,null,[i("header",O,[i("img",{src:S(E),alt:r.$t("text.upc.logo")},null,8,j),i("h1",null,v(r.$t("select.your.bank.for.payment")),1),l[0]||(l[0]=i("div",null,null,-1))]),i("main",J,[i("ul",q,[(u(!0),g(m,null,V(o.value,s=>(u(),g("li",{key:s.code,class:"bank-list-page__li"},[i("button",{type:"button",class:"bank-list-page__button-action",onClick:b=>U(s.code)},[i("img",{src:_(s.iconUrl),alt:r.$t(s.iconAltTextI18nKey)},null,8,Z),i("span",null,v(r.$t(s.titleI18nKey)),1),s.isFavorite?(u(),g("img",{key:0,src:K,alt:r.$t("text.icon.star.filled")},null,8,z)):(u(),g("img",{key:1,src:$,alt:r.$t("text.icon.star")},null,8,Q))],8,G)]))),128))])])],64))}});export{X as default};
