import{$ as U,d as S,r as m,o as d,c as u,a as i,e as V,t as h,b as x,F as f,f as K,g as C}from"./index-BrGx-xbD.js";import{b as A}from"./browser-CboWctPp.js";const H="/icons/tabler/star-filled.svg",F="/icons/tabler/star.svg",y=new Map;y.set("901",{code:"901",iconAltTextI18nKey:"bank.privat.logo.alt",iconUrl:"/icons/banks/privat.svg",titleI18nKey:"bank.privat"});y.set("902",{code:"902",iconAltTextI18nKey:"bank.monobank.logo.alt",iconUrl:"/icons/banks/monobank.svg",titleI18nKey:"bank.monobank"});y.set("903",{code:"903",iconAltTextI18nKey:"bank.abank.logo.alt",iconUrl:"/icons/banks/abank.svg",titleI18nKey:"bank.abank"});const $=y,T=t=>Array.isArray(t)?t.every(e=>typeof e=="string"&&e.length===3):!1,p={favoriteBanksCodes:{get(){try{const t=localStorage.getItem("favorite-banks-codes");if(!t)return new Set;const e=JSON.parse(t);return T(e)?new Set(e):new Set}catch(t){return console.error("Failed to load favorite banks codes"),new Set}},set(t){try{localStorage.setItem("favorite-banks-codes",JSON.stringify(Array.from(t)))}catch(e){console.error("Failed to save favorite banks codes")}}},lastUsedBankCode:{get(){try{const t=localStorage.getItem("lastUsedBankCode");return t&&t.length===3?t:null}catch(t){return console.error("Failed to load last used bank code"),null}},set(t){try{localStorage.setItem("lastUsedBankCode",t)}catch(e){console.error("Failed to save last used bank code")}}}},I=(t,e)=>{try{const{code:o}=t,a=$.get(o);return a?{...a,isFavorite:e.has(o)}:null}catch(o){return null}},L=async t=>U.get("http://localhost:8080/api/payByBank/bankList/".concat(t)).then(({data:e})=>{if(e.invoiceId!==t)throw new Error("Invalid response");return e.banks.map(o=>I(o,p.favoriteBanksCodes.get())).filter(o=>o!==null)}).catch(()=>(console.error("Failed to fetch banks list"),[{code:"901",iconAltTextI18nKey:"bank.privat.logo.alt",iconUrl:"/icons/banks/privat.svg",titleI18nKey:"bank.privat"},{code:"902",iconAltTextI18nKey:"bank.monobank.logo.alt",iconUrl:"/icons/banks/monobank.svg",titleI18nKey:"bank.monobank"},{code:"903",iconAltTextI18nKey:"bank.abank.logo.alt",iconUrl:"/icons/banks/abank.svg",titleI18nKey:"bank.abank"}].map(e=>I(e,p.favoriteBanksCodes.get())).filter(e=>e!==null)));var n=[];for(var b=0;b<256;++b)n.push((b+256).toString(16).slice(1));function D(t,e=0){return(n[t[e+0]]+n[t[e+1]]+n[t[e+2]]+n[t[e+3]]+"-"+n[t[e+4]]+n[t[e+5]]+"-"+n[t[e+6]]+n[t[e+7]]+"-"+n[t[e+8]]+n[t[e+9]]+"-"+n[t[e+10]]+n[t[e+11]]+n[t[e+12]]+n[t[e+13]]+n[t[e+14]]+n[t[e+15]]).toLowerCase()}var k,N=new Uint8Array(16);function R(){if(!k&&(k=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!k))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return k(N)}var M=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const _={randomUUID:M};function P(t,e,o){if(_.randomUUID&&!e&&!t)return _.randomUUID();t=t||{};var a=t.random||(t.rng||R)();return a[6]=a[6]&15|64,a[8]=a[8]&63|128,D(a)}const E=async(t,e)=>{const o=P(),{data:a}=await U.post("http://localhost:8080/api/payByBank/preparePay",{invoiceId:t,bankCode:e},{headers:{"User-Info":o}}),c=p.favoriteBanksCodes.get();return c.has(e)||(c.add(e),p.favoriteBanksCodes.set(c)),p.lastUsedBankCode.set(e),a},O="data:image/svg+xml,%3csvg%20width='41'%20height='20'%20viewBox='0%200%2041%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M34.1395%205.55421H40.4837V0.00806114H34.1395C31.3503%200.00806114%2028.9399%201.74123%2027.7711%204.24829C26.5699%201.67674%2024.0145%200.00806114%2021.2495%200.00806114H14.2604V0.0322446C14.2604%200.0241833%2014.2523%200.00806114%2014.2362%200.00806114H11.1245C10.0202%200.00806114%209.11729%200.975413%209.11729%202.16848V7.52922C9.11729%208.66586%208.36759%209.71383%207.31157%209.81056C6.13462%209.92342%205.14309%208.92382%205.14309%207.67432V0.0322446C5.14309%200.00806077%205.13503%200%205.11084%200H0.0322452C0.00806139%200%200%200.00806077%200%200.0322446V7.38412C0%2011.4873%202.87787%2015.0988%206.67473%2015.3406C10.8182%2015.6066%2014.2523%2012.0838%2014.2523%207.67432V5.53003V5.53809H21.3624C22.1524%205.53809%2022.9182%206.0137%2023.2084%206.79565C23.7807%208.33535%2022.7408%209.81056%2021.3785%209.81056H19.4599H16.2596C15.1552%209.81056%2014.2523%2010.7779%2014.2523%2011.971V15.3567V20H19.4599V15.3567H21.3785C24.1757%2015.3567%2026.5861%2013.6235%2027.7549%2011.1084C28.9238%2013.6235%2031.3341%2015.3567%2034.1314%2015.3567H40.4756V9.81056H34.1314C33.0351%209.81056%2032.1483%208.85127%2032.1483%207.67432C32.1564%206.5135%2033.0431%205.55421%2034.1395%205.55421Z'%20fill='%231369FF'/%3e%3c/svg%3e",j={class:"bank-list-page__header"},q=["src","alt"],J={class:"bank-list-page__main"},G=["src"],Z={class:"bank-list-page__ul"},z=["onClick"],Q=["src","alt"],W=["alt"],X=["alt"],et=S({__name:"index",props:{invoiceId:{type:Number,required:!0}},emits:{loaded:()=>!0,error:()=>!0},setup(t,{emit:e}){const o=t,a=m([]),c=m(null),g=e;(async()=>{document.body.classList.add("mobile");const r=o.invoiceId;if(!r){g("error");return}const l=await L(r).catch(()=>null);if(!l||!l.length){console.error("No banks"),g("error");return}const s=p.lastUsedBankCode.get();if(!s){a.value=l,g("loaded");return}a.value=[...l].sort((v,B)=>v.code===s?-1:B.code===s?1:0),g("loaded")})();const w=async r=>{alert("Navigate to app with bank code: ".concat(r)),C.show();const l=await E(o.invoiceId,r);c.value=await A.toDataURL(l,{width:300}).catch(()=>null),C.hide()};return(r,l)=>(d(),u(f,null,[i("header",j,[i("img",{src:V(O),alt:r.$t("text.upc.logo")},null,8,q),i("h1",null,h(r.$t("select.your.bank.for.payment")),1),l[0]||(l[0]=i("div",null,null,-1))]),i("main",J,[c.value?(d(),u("img",{key:0,src:c.value,alt:""},null,8,G)):x("",!0),i("ul",Z,[(d(!0),u(f,null,K(a.value,s=>(d(),u("li",{key:s.code,class:"bank-list-page__li"},[i("button",{type:"button",class:"bank-list-page__button-action",onClick:v=>w(s.code)},[i("img",{src:s.iconUrl,alt:r.$t(s.iconAltTextI18nKey)},null,8,Q),i("span",null,h(r.$t(s.titleI18nKey)),1),s.isFavorite?(d(),u("img",{key:0,src:H,alt:r.$t("text.icon.star.filled")},null,8,W)):(d(),u("img",{key:1,src:F,alt:r.$t("text.icon.star")},null,8,X))],8,z)]))),128))])])],64))}});export{et as default};
